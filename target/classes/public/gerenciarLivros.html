<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gerenciar Livros</title>
  <link rel="stylesheet" href="Header.css">
  <link rel="stylesheet" href="estilo.css">
  <link rel="stylesheet" href="central.css">

</head>
<body>
    <header id="main-header" class="main-header"></header>

    <div class="admin-container">
        <header class="admin-page-header">
            <div class="title-section">
                <span class="admin-badge">Admin Mode</span>
                <h1>Central de Acervo</h1>
                <div class="title-underline"></div>
            </div>
            </header>

        <main id="livros-grid" class="grid-container">
            </main>
    </div>

    <footer class="admin-footer">
        <p>“Este site utiliza cookies estritamente necessários para salvar preferências de leitura e progresso. 
        Segurança e integridade garantidas pelo ecossistema <strong>NULL ARCHIVE</strong>.”</p>
    </footer>

    <script src="Header.js"></script>
    </body>

<script>
    async function atualizaBooks(){
      const grid = document.getElementById('livros-grid');

      const res = await fetch(`http://127.0.0.1:8081/search/books?admin`, {
        credentials: "include"
      });
      
      const data = await res.json();

      grid.innerHTML = '';

      data.forEach(book => {
        const card = document.createElement('div');
        card.className = 'book-card';
    
        const coverUrl = book.storage_path_image 
            ? `http://127.0.0.1:8081/user/image/${book.storage_path_image}` 
            : 'placeholder.png';
    
            // Gerar o HTML das tags dinamicamente
          // Pegamos apenas as 3 primeiras (slice) caso o back mande mais por erro
    
          let tagsArray = [];
    
          if (book.tags) {
              if (Array.isArray(book.tags)) {
                  // Se já for um array (veio tratado do Java)
                  tagsArray = book.tags;
              } else if (typeof book.tags === 'string') {
                  // Se veio como string "terror,fantasia", transforma em array
                  tagsArray = book.tags.split(',');
              }
          }
    
          const tagsHtml = tagsArray
              .slice(0, 3) 
              .map(tag => `<span class="tag-pill">${tag.trim()}</span>`)
              .join('');
    
              
        card.innerHTML = `
            <div class="card-cover">
                <img src="${coverUrl}" alt="Capa de ${book.title}">
            </div>
            <div class="card-info">
                <h3 class="book-title">${book.title}</h3>
                <span class="book-author">${book.author_name || 'Autor desconhecido'}</span>
                
                <div class="card-tags">
                    ${tagsHtml}
                </div>
            </div>
        `;
    
        card.addEventListener('click', () => {
            window.location.href = `visualizarLivro.html?id=${book.id}&admin`;
        });
    
        grid.appendChild(card);
      });
    }
    atualizaBooks();
</script>
</html>

