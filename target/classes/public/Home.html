<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Home</title>
    <link rel="stylesheet" href="estilo.css">
</head>
<body>

  <h1>Home</h1>

  <!-- Vis√≠vel apenas para N√ÉO autenticados -->
  <div id="nonaccount-actions">
    <p>Deseja compartilhar um livro?</p>
    <a href="loginUsuario.html">Entre na sua conta</a><br>
    <a href="cadastroUsuario.html">Crie sua conta</a>
  </div>

  <!-- Vis√≠vel apenas para autenticados -->
  <div id="account-actions" style="display:none;">
    <p>Bem-vindo, <span id="name"></span></p>
    <a href="novoLivro.html">Adicionar novo livro</a>
    <button id="logout">Encerrar sess√£o</button>
  </div>

  <main id="livros-grid" class="grid-container">
  </main>


</body>

<footer>
  <p>‚ÄúEste site utiliza cookies estritamente necess√°rios para salvar prefer√™ncias de leitura e progresso, mesmo sem cadastro.
N√£o utilizamos cookies de rastreamento ou publicidade.‚Äù</p>
</footer>


<script>
async function loadUserToken() {
  const res = await fetch("http://127.0.0.1:8081/user/token", {
    method: "POST",
    credentials: "include"
  });
}
async function loadContext() {
  const res = await fetch("http://127.0.0.1:8081/editor/data", {
    credentials: "include"
  });
  
  if (!res.ok) {
    showNonaccount();
    return;
  }
  
  const data = await res.json();
  
  if (data.authenticated === true) {
    showAccount(data);
  } else {
    showNonaccount();
  }
}

function showNonaccount() {
  document.getElementById("nonaccount-actions").style.display = "block";
  document.getElementById("account-actions").style.display = "none";
}

function showAccount(data) {
  document.getElementById("nonaccount-actions").style.display = "none";
  document.getElementById("account-actions").style.display = "block";
  document.getElementById("name").textContent = data.username;
}

loadUserToken();
loadContext();

document.getElementById("logout").addEventListener("click", async function (e) {
  e.preventDefault(); // üö´ impede o submit padr√£o
  
  const response = await fetch("http://127.0.0.1:8081/editor/logout", {
    method: "POST",
    credentials: "include",
    
  });
  
  if (response.ok) {
    window.location.href = "loginUsuario.html";
  } else {
    const text = await response.text();
    alert("Erro: " + text);
  }
});


</script>
</html>

